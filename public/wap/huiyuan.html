<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<title>充值会员</title>
		<link rel="stylesheet" type="text/css" href="icons/iconfont.css" />
		<link rel="stylesheet" type="text/css" href="icons/pingfang.css" />
		<style type="text/css">
			* {
				padding: 0;
				margin: 0;
				box-sizing: border-box;
			}
			
			html,
			body {
				width: 100%;
				height: 100%;
				background: #f5f5f5;
			}
			
			a {
				text-decoration: none;
			}
			
			.liubai {
				width: 100%;
				background: #F5F5F5;
				height: 0.2rem;
			}
			
			.hycon {
				width: 100%;
				height: auto;
				background: #fff;
			}
			
			.hytop {
				width: 96%;
				height: 3.09rem;
				background: url(img/hytopbg.png) no-repeat;
				background-size: 100% 3.09rem;
				margin: 0 2%;
				position: relative;
				padding-left: 2rem;
				padding-top: 0.84rem;
				display: flex;
			}
			
			.imgdiv {
				width: 1.68rem;
				height: 1.68rem;
				border-radius: 100%;
			}
			
			.imgdiv img {
				width: 100%;
				height: 100%;
				border-radius: 100%;
			}
			
			.xinxidiv {
				margin-left: 0.43rem;
			}
			
			.renname {
				color: #fff;
				font-size: 0.34rem;
				font-weight: bold;
				margin-top: 0.3rem;
			}
			
			.shifouvip {
				color: #ffdca8;
				margin-top: 0.2rem;
				font-size: 0.34rem;
			}
			
			.hycenter {
				width: 100%;
			}
			
			.zfstylediv {
				padding: 0.5rem 0;
				width: 96%;
				text-align: center;
				margin: 0 2%;
				border-bottom: 1px solid #F3F4F5;
				height: 1.45rem;
			}
			
			.zfstyle {
				color: #333;
				font-size: 0.4rem;
				width: 20%;
				display: inline-block;
				text-align: center;
				position: relative;
				height: 100%;
			}
			
			.bomline {
				position: absolute;
				width: 0.81rem;
				height: 0.06rem;
				background: #ffdd00;
				left: 50%;
				margin-left: -0.4rem;
				display: none;
				top: 0.9rem;
				border-radius: 0.6rem;
			}
			
			.lineactive {
				display: block;
			}
			
			.zflist {
				display: none;
			}
			
			.zflistactive {
				display: block;
			}
			
			.zfli,.zfliwx {
				display: flex;
				width: 100%;
				height: 1.7rem;
			}
			
			.zfliright {
				display: flex;
				border-bottom: 1px solid #f3f4f5;
				position: relative;
				width: 85%;
			}
			
			.zfliright:after {
				position: absolute;
				right: 0.4rem;
				top: 50%;
				display: inline-block;
				content: "";
				width: 0.24rem;
				height: 0.24rem;
				border: solid #999;
				border-width: 1px 1px 0 0;
				-webkit-transform: translate(0, -50%) rotate(45deg);
				transform: translate(0, -50%) rotate(45deg);
			}
			
			.liimgdiv {
				width: 1.56rem;
				height: 1.56rem;
			}
			
			.liimgdiv img {
				width: 100%;
				height: 100%;
			}
			
			.lilefttop {
				margin-top: 0.31rem;
				vertical-align: middle;
			}
			
			.hystyle {
				font-size: 0.4rem;
				color: #333;
				vertical-align: middle;
			}
			
			.tuijianzf {
				width: 1.03rem;
				height: 0.4rem;
				vertical-align: middle;
			}
			
			.lileftbom {
				margin-top: 0.2rem;
			}
			
			.nowjiage {
				font-size: 0.31rem;
				color: #999;
			}
			
			.oldjiage {
				font-size: 0.25rem;
				color: #999;
				text-decoration: line-through;
			}
			
			.shuline {
				color: #999;
			}
			
			.xianshi {
				color: #999;
				font-size: 0.34rem;
			}
			
			.liriright {
				position: absolute;
				right: 1rem;
				text-align: right;
				top: 0.31rem;
			}
			
			.lirighttop {
				color: #ff4151;
				font-size: 0.43rem;
				margin-bottom: 0.05rem;
			}
			
			.lirightbom {
				color: #999;
				font-size: 0.34rem;
			}
			
			.tqtitle {
				/*font-family: PingFang Medium;*/
				font-size: 0.43rem;
				color: #000;
				margin: 0.5rem 0 0.2rem 0.4rem;
			}
			
			.zytitle {
				/*font-family: PingFang Medium;*/
				font-size: 0.43rem;
				color: #000;
				margin: 0.4rem 0 0.28rem 0.4rem;
			}
			
			.tqimgdiv {
				width: 96%;
				margin: 0 2%;
			}
			
			.tqimg {
				width: 100%;
				height: 100%;
			}
			.zyneirong{
				margin-bottom: 0.53rem;
			}
			.zyneirong p {
				color: #666;
				font-size: 0.34rem;
				margin-bottom: 0.12rem;
				margin-left: 0.4rem;
			}
		</style>
		<script src="flexible.min.js" type="text/javascript" charset="utf-8"></script>
	</head>

	<body>
		<div class="liubai"></div>
		<div class="hycon">
			<div class="hytop">
				<div class="imgdiv">
					<img src="" alt="" id="userhead"/>
				</div>
				<div class="xinxidiv">
					<div class="renname" id="username"></div>
					<div class="shifouvip" id="isviptishi"></div>
				</div>
			</div>
			<div class="hycenter">
				<div class="zfstylediv">
					<div class="style1 zfstyle">
						<span>支付宝</span>
						<div class="bomline lineactive"></div>
					</div>
					<div class="style2 zfstyle">
						<span>微&nbsp;信</span>
						<div class="bomline"></div>
					</div>
				</div>
				<div class="zflistdiv">
					<div class="zflist1 zflist zflistactive">
						<div class="zfli">
							<div class="liimgdiv">
								<img src="img/vip_icon_year.png" alt="" class="nianhy" />
							</div>
							<div class="zfliright">
								<div class="lirileft">
									<div class="lilefttop">
										<span class="hystyle">年卡会员</span>
										<img src="img/tuijianzf.png" alt="" class="tuijianzf" />
									</div>
									<div class="lileftbom">
										<span class="nowjiage">¥198</span>
										<span class="oldjiage">¥216</span>
										<span class="shuline">|</span>
										<span class="xianshi">限时2.43折</span>
									</div>
								</div>
								<div class="liriright">
									<div class="lirighttop">¥0.54</div>
									<div class="lirightbom">每日仅需</div>
								</div>
							</div>
						</div>
						<div class="zfli">
							<div class="liimgdiv">
								<img src="img/vip_icon_month.png" alt="" class="nianhy" />
							</div>
							<div class="zfliright">
								<div class="lirileft">
									<div class="lilefttop">
										<span class="hystyle">月卡会员</span>
									</div>
									<div class="lileftbom">
										<span class="nowjiage">¥190</span>
										<span class="oldjiage">¥216</span>
										<span class="shuline">|</span>
										<span class="xianshi">限时2.43折</span>
									</div>
								</div>
								<div class="liriright">
									<div class="lirighttop">¥0.54</div>
									<div class="lirightbom">每日仅需</div>
								</div>
							</div>
						</div>
						<div class="zfli">
							<div class="liimgdiv">
								<img src="img/vip_icon_month.png" alt="" class="nianhy" />
							</div>
							<div class="zfliright">
								<div class="lirileft">
									<div class="lilefttop">
										<span class="hystyle">季度会员</span>
									</div>
									<div class="lileftbom">
										<span class="nowjiage">¥180</span>
										<span class="oldjiage">¥216</span>
										<span class="shuline">|</span>
										<span class="xianshi">限时2.43折</span>
									</div>
								</div>
								<div class="liriright">
									<div class="lirighttop">¥0.54</div>
									<div class="lirightbom">每日仅需</div>
								</div>
							</div>
						</div>
						<div class="zfli">
							<div class="liimgdiv">
								<img src="img/vip_icon_banyear.png" alt="" class="nianhy" />
							</div>
							<div class="zfliright">
								<div class="lirileft">
									<div class="lilefttop">
										<span class="hystyle">半年会员</span>
									</div>
									<div class="lileftbom">
										<span class="nowjiage">¥170</span>
										<span class="oldjiage">¥216</span>
										<span class="shuline">|</span>
										<span class="xianshi">限时2.43折</span>
									</div>
								</div>
								<div class="liriright">
									<div class="lirighttop">¥0.54</div>
									<div class="lirightbom">每日仅需</div>
								</div>
							</div>
						</div>
					</div>
					<div class="zflist2 zflist">
						<div class="zfliwx">
							<div class="liimgdiv">
								<img src="img/vip_icon_year.png" alt="" class="nianhy" />
							</div>
							<div class="zfliright">
								<div class="lirileft">
									<div class="lilefttop">
										<span class="hystyle">年卡会员</span>
										<img src="img/tuijianzf.png" alt="" class="tuijianzf" />
									</div>
									<div class="lileftbom">
										<span class="nowjiage">¥98</span>
										<span class="oldjiage">¥216</span>
										<span class="shuline">|</span>
										<span class="xianshi">限时2.43折</span>
									</div>
								</div>
								<div class="liriright">
									<div class="lirighttop">¥0.55</div>
									<div class="lirightbom">每日仅需</div>
								</div>
							</div>
						</div>
						<div class="zfliwx">
							<div class="liimgdiv">
								<img src="img/vip_icon_month.png" alt="" class="nianhy" />
							</div>
							<div class="zfliright">
								<div class="lirileft">
									<div class="lilefttop">
										<span class="hystyle">月卡会员</span>
									</div>
									<div class="lileftbom">
										<span class="nowjiage">¥88</span>
										<span class="oldjiage">¥216</span>
										<span class="shuline">|</span>
										<span class="xianshi">限时2.43折</span>
									</div>
								</div>
								<div class="liriright">
									<div class="lirighttop">¥0.55</div>
									<div class="lirightbom">每日仅需</div>
								</div>
							</div>
						</div>
						<div class="zfliwx">
							<div class="liimgdiv">
								<img src="img/vip_icon_month.png" alt="" class="nianhy" />
							</div>
							<div class="zfliright">
								<div class="lirileft">
									<div class="lilefttop">
										<span class="hystyle">季度会员</span>
									</div>
									<div class="lileftbom">
										<span class="nowjiage">¥78</span>
										<span class="oldjiage">¥216</span>
										<span class="shuline">|</span>
										<span class="xianshi">限时2.43折</span>
									</div>
								</div>
								<div class="liriright">
									<div class="lirighttop">¥0.55</div>
									<div class="lirightbom">每日仅需</div>
								</div>
							</div>
						</div>
						<div class="zfliwx">
							<div class="liimgdiv">
								<img src="img/vip_icon_banyear.png" alt="" class="nianhy" />
							</div>
							<div class="zfliright">
								<div class="lirileft">
									<div class="lilefttop">
										<span class="hystyle">半年会员</span>
									</div>
									<div class="lileftbom">
										<span class="nowjiage">¥68</span>
										<span class="oldjiage">¥216</span>
										<span class="shuline">|</span>
										<span class="xianshi">限时2.43折</span>
									</div>
								</div>
								<div class="liriright">
									<div class="lirighttop">¥0.55</div>
									<div class="lirightbom">每日仅需</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="hytequan">
			<div class="tqtitle">功能特权</div>
			<div class="tqimgdiv">
				<img src="img/tqimg.png" alt="" class="tqimg" />
			</div>
		</div>
		<div class="zysxdiv">
			<div class="zytitle">注意事项</div>
			<div class="zyneirong">
				<p>1、同类型的会员多次开通，可以累加会员有效时间</p>
				<p>2、会员勋章只会展示最高等级的勋章</p>
				<p>3、当开启更高等级的会员时，低等级的会员会失效，当有高等级会员时，无法再开通低等级的会员</p>
			</div>
		</div>

		<!--<script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>-->
		<script src="yuming.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/jquery-3.2.1.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="alertMsg.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			function GetRequest() {
				var url = location.search; //获取url中"?"符后的字串
				var theRequest = new Object();
				if(url.indexOf("?") != -1) {
					var str = url.substr(1);
					strs = str.split("&");
					for(var i = 0; i < strs.length; i++) {
						theRequest[strs[i].split("=")[0]] = unescape(strs[i].split("=")[1]);
					}
				}
				return theRequest;
			}

			var request = new Object();
			request = GetRequest();
			var yztoken = request['token'];
			var yzdevice = request['device'];
			var yzid = request['uid'];
//			var yztoken = 'e6d60e2923f3bdfc997692f73d32e8e656ea806ca5846c828d0b7f86591a2b99';
//			var yzdevice = 'android';
//			var yzid = 8;

			$('.zfstyle').click(function() {
				var _index = $(this).index();
				$('.zfstyle .lineactive').removeClass('lineactive');
				$(this).children('.bomline').addClass('lineactive');
				$('.zflist').hide().eq($(this).index()).show();
			})

			//通过id获取用户是否为VIP 0:否   1：是
			var isvip = '';
			var userhead = '';
			var username = '';

			var ifvipurl = geturl(oneurl, 'user/public/getNameById');

			function ifvip() {
				$.ajax({
					type: 'get',
					url: ifvipurl,
					async: false,
					data: {
						'id': yzid
					},
					success: function(result) {
						console.log(JSON.stringify(result));
						//时间戳
						var xftime = result.data[0]['vip_time'];
						//获取时间
						var date = new Date(xftime * 1000);
						Y = date.getFullYear() + '-';
						M = (date.getMonth() + 1 < 10 ? '0' + (date.getMonth() + 1) : date.getMonth() + 1) + '-';
						D = change(date.getDate()) + ' ';
						h = change(date.getHours()) + ':';
						m = change(date.getMinutes()) + ':';
						s = change(date.getSeconds());
						console.log(Y + M + D + h + m + s);

						function change(t) {
							if(t < 10) {
								return "0" + t;
							} else {
								return t;
							}
						}
						isvip = result.data[0].vip;
						if(isvip == 0) {
							document.getElementById('isviptishi').innerHTML = '您尚未开通VIP';
						} else if(isvip == 1) {
							document.getElementById('isviptishi').innerHTML = '到期时间：'+Y + M + D;
						}
						userhead = result.data[0].avatar;
						if(userhead == '') {
							document.getElementById('userhead').src = 'img/mtoux.jpg';
						} else {
							document.getElementById('userhead').src = userhead;
						}
						document.getElementById('username').innerHTML = result.data[0].nickname;
					},
					error: function() {
						console.log('获取用户信息失败');
					}
				})
			}
			ifvip();

			//选择的时长价格
			var scmoney = '';
			//选择支付方式
			var charge_type = 'zhifubao';
			//充值类型 2是VIP
			var typetype = 2;
			var viphtml = '';			

			//支付宝跳转支付
				var scway = document.getElementsByClassName('zfli');
				for(var i = 0; i < scway.length; i++) {
					scway[i].addEventListener('click', function() {
						//获取到点击的钱数
						scmoney = this.children[1].children[0].children[1].children[0].innerHTML.substr(1);
						console.log(scmoney);
						//支付宝是1
						charge_type = 1;
						zhifu(2,1,scmoney);
					})					
				}
				//微信跳转支付
				var scwaywx = document.getElementsByClassName('zfliwx');
				for(var i = 0; i < scwaywx.length; i++) {
					scwaywx[i].addEventListener('click', function() {
						//获取到点击的钱数
						scmoney = this.children[1].children[0].children[1].children[0].innerHTML.substr(1);
						console.log(scmoney);
						//微信是2
						charge_type = 2;
						zhifu(2,2,scmoney);
					})					
				}
			function zhifu(typetype,charge_type,scmoney){
				console.log(typetype);
				console.log(charge_type);
				console.log(scmoney);
				var zhifuurl = geturl(oneurl, 'pay/index/payOrder');
				$.ajax({
						headers: {
							'YZ-Token': yztoken,
							'YZ-Device-Type': yzdevice
						},
						type: "post",
						url: zhifuurl,
						async: false,
						data: {
							'type': typetype,
							'mode': charge_type,
							'money': scmoney
						},
						success: function(result) {
							console.log(JSON.stringify(result));
							//如果是ios 支付宝和微信都通过openURL的方式打开
							//如果是安卓  支付宝用openURL打开，微信用SDK方式
							//plus.runtime.openURL(result.data.url);
							var u = navigator.userAgent,
								app = navigator.appVersion;
							var isAndroid = u.indexOf('Android') > -1 || u.indexOf('Linux') > -1; //g
							var isIOS = !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/); //ios终端
							if(isAndroid) {
								//console.log("安卓机！");
								if(charge_type == 1) {
									//console.log('跳转到支付宝');
									window.location.href = result.data.url;
								} else if(charge_type == 2) {
									var wxurl = result.data.url;
									console.log(wxurl);
									$.ajax({
										type: 'POST',
										url: wxurl,
										dataType: 'json',
										data: {},
										success: function(rsp) {
											console.log(JSON.stringify(rsp));
											var wxxinxi = {
												timestamp: rsp.result_data.timestamp,
												noncestr: rsp.result_data.noncestr,
												partnerid: rsp.result_data.partnerid,
												prepayid: rsp.result_data.prepayid,
												package: rsp.result_data.package,
												appid: rsp.result_data.appid,
												sign: rsp.result_data.sign
											};
											plus.payment.request(pays[id], wxxinxi, function(result) {
												console.log(JSON.stringify(result));
											}, function(e) {
												console.error(JSON.stringify(e));
											})
										},
										error: function(data) {
											console.log(JSON.stringify(data));
											console.log('微信支付出错');
										}
									})
								}
							}
							if(isIOS) {
								console.log("苹果机！");
								if(charge_type == 1) {
									//alert('支付宝支付');
									//var urlstr = encodeURI(result.data.url);
									//plus.runtime.openURL(urlstr);
									window.location.href = result.data.url;
									console.log(JSON.stringify(result.data.url));
								}
								if(charge_type == 2) {
									//alert('微信支付');
									//var urlstr = encodeURI(result.data.url);
									//window.location.href = urlstr;
									alertMsg('微信支付目前暂未开通');
								}
							}
						},
						error: function(result) {
							console.log('充值订单出错了');
						}
					});
			}
		</script>
	</body>

</html>